(this.webpackJsonphommbattle=this.webpackJsonphommbattle||[]).push([[0],{11:function(t,e,a){t.exports=a(19)},16:function(t,e,a){},18:function(t,e,a){},19:function(t,e,a){"use strict";a.r(e);var n=a(0),i=a.n(n),r=a(8),s=a.n(r),c=(a(16),a(1)),o=a.n(c),l=a(5),u=a(3),f=a(4),h=a(2),d=a(10),p=a(9),v=(a(18),15),m=11,k=0,y=1,b=2,g=4,_=[],x=function(t){Object(d.a)(a,t);var e=Object(p.a)(a);function a(t){var n;return Object(u.a)(this,a),(n=e.call(this,t)).state={markUp:[],army:t.army,units:[]},n.svgContainer={width:"61",height:"70",viewBox:"0 0 60.6217782649107 70",path:"M30.31088913245535 0L60.6217782649107 17.5L60.6217782649107 52.5L30.31088913245535 70L0 52.5L0 17.5Z"},n._handleCellClick=n._handleCellClick.bind(Object(h.a)(n)),n._findPath=n._findPath.bind(Object(h.a)(n)),n}return Object(f.a)(a,[{key:"componentDidMount",value:function(){var t=Object(l.a)(o.a.mark((function t(){var e,a,n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n in e=this.state.army,a=[],e)e[n].forEach((function(t){return a.push(t)}));return a.sort((function(t,e){return e.speed-t.speed})),this._setVirtualField(!0),this._setMovableCells(a[0]),t.next=8,this.setState({units:a,currentUnit:a[0],markUp:this._makeMarkUp()});case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var t=Object(l.a)(o.a.mark((function t(e,a){var n,i,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a.currentUnit){t.next=10;break}if(n=this.state.currentUnit,i=n.position,r=a.currentUnit.position,i.x===r.x&&i.y===r.y){t.next=10;break}return this._setVirtualField(),this._setUnitPositionInField(n,a.currentUnit),this._setMovableCells(n),t.next=10,this.setState({markUp:this._makeMarkUp()});case 10:case"end":return t.stop()}}),t,this)})));return function(e,a){return t.apply(this,arguments)}}()},{key:"_handleCellClick",value:function(){var t=Object(l.a)(o.a.mark((function t(e){var a,n,i,r,s,c,l,u,f,h;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("svg"===e.target.tagName){t.next=2;break}return t.abrupt("return");case 2:if(a=e.target.dataset,n=+a.col,i=+a.row,r=_[i-1],s=r[n-1],c=this.state.currentUnit.position,s!==k&&(c.x!==n||c.y!==i)){t.next=10;break}return t.abrupt("return");case 10:return l=this.state.currentUnit,u=l.position.x,f=u-n>0?"left":"right",l.size===b&&("left"===l.battleSide&&"right"===f?r[n]!==g&&n--:"right"===l.battleSide&&"left"===f&&r[n-b]!==g&&n++),h=Object.assign({},this.state.currentUnit,{position:{x:n,y:i},direction:f}),t.next=17,this.setState({currentUnit:h});case 17:this._findPath(n,i);case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"_findPath",value:function(t,e){}},{key:"_makeMarkUp",value:function(){for(var t=[],e=1;e<=m;e++){for(var a=[],n="battlefield_row battlefield_row--".concat(e%2===0?"even":"odd"),r=1;r<=v;r++){var s="battlefield_cell";switch(_[e-1][r-1]){case y:case b:s+=" ".concat(s,"--currentUnit");break;case g:s+=" ".concat(s,"--movable")}a.push(i.a.createElement("svg",{key:"cell_".concat(e,"-").concat(r),"data-row":e,"data-col":r,className:s,width:this.svgContainer.width,height:this.svgContainer.height,viewBox:this.svgContainer.viewBox},i.a.createElement("path",{d:this.svgContainer.path})))}t.push(i.a.createElement("div",{key:"row_".concat(e),className:n},a))}return t}},{key:"_setVirtualField",value:function(t){for(var e=this.state.army,a=0;a<m;a++){t&&_.push([]);for(var n=0;n<v;n++){if(t)for(var i in e){var r=e[i][a];a===(null===r||void 0===r?void 0:r.position.y)-1&&n===(null===r||void 0===r?void 0:r.position.x)-1&&this._setUnitPositionInField(r)}_[a][n]&&_[a][n]!==g||(_[a][n]=k)}}}},{key:"_setUnitPositionInField",value:function(t,e){var a=t.position,n=a.y-1,i=a.x-1;if(_[n][i]=t.size,e&&(_[e.position.y-1][e.position.x-1]=k),t.size===b){var r="left"===t.battleSide?i+1:i-1;if(_[n][r]=t.size,e){var s="left"===t.battleSide?e.position.x+1:e.position.x-b;_[e.position.y-1][s]=k}}}},{key:"_setMovableCells",value:function(t){for(var e=[],a=t.position,n=t.speed,i=t.battleSide,r=0,s=0;s<=n;s++){var c=a.y+s;c!==a.y&&c%2!==0&&r++;for(var o=0;o<2*n+t.size-s;o++){var l=n+("left"===i?t.size-1:0),u=(o>l?a.x-o+l:a.x+o)-r;e.push("".concat(u," ").concat(c)),c!==c-2*s&&e.push("".concat(u," ").concat(c-2*s))}}return e.forEach((function(t){var e=+t.split(" ")[1],a=+t.split(" ")[0];a>0&&a<=v&&e>0&&e<=m&&_[e-1][a-1]===k&&(_[e-1][a-1]=g)})),_}},{key:"render",value:function(){return i.a.createElement("div",{className:"battleField_main",onClick:this._handleCellClick},this.state.markUp)}}]),a}(i.a.Component),w=a(6),U={castle:{spearman:{attack:4,defence:5,damage:[1,3],health:10,speed:4,size:1,fly:!1,range:!1},archer:{attack:6,defence:3,damage:[2,3],health:10,speed:4,size:1,fly:!1,range:!0},griffin:{attack:8,defence:8,damage:[3,6],health:25,speed:6,size:2,fly:!0,range:!1},swordsman:{attack:10,defence:12,damage:[6,9],health:35,speed:5,size:1,fly:!1,range:!1},monk:{attack:12,defence:7,damage:[10,12],health:30,speed:5,size:1,fly:!1,range:!0},cavalryman:{attack:15,defence:15,damage:[15,25],health:100,speed:7,size:2,fly:!1,range:!1},angel:{attack:20,defence:20,damage:[50,50],health:200,speed:12,size:1,fly:!0,range:!1}}},C=(new(function(){function t(){Object(u.a)(this,t),t._instance=this}return Object(f.a)(t,[{key:"create",value:function(t,e,a){return Object(w.a)(Object(w.a)({},U[t][e]),a)}},{key:"getInstance",value:function(){return t._instance}}]),t}())).getInstance(),z={left:{fraction:"castle",units:[{name:"swordsman",size:50},{name:"griffin",size:30}]},right:{fraction:"castle",units:[{name:"cavalryman",size:40}]}},j={left:[],right:[]},O=function(t){var e=z[t];e.units.forEach((function(a,n){var i={position:{x:"left"===t?1:15,y:n+1},direction:"left"===t?"right":"left",battleSide:t};j[t].push(C.create(e.fraction,a.name,i))}))};for(var E in z)O(E);s.a.render(i.a.createElement(x,{army:j}),document.getElementById("root"))}},[[11,1,2]]]);
//# sourceMappingURL=main.c75ff465.chunk.js.map